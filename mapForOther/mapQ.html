<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width">
    <title>热力图</title>
    <link rel="stylesheet" href="http://cache.amap.com/lbs/static/main1119.css"/>
    <script src="http://webapi.amap.com/maps?v=1.4.2&key=bbbde4f59c905d99f53ba3126eb6cbab&plugin=AMap.EllipseEditor"></script>
    <script type="text/javascript" src="http://cache.amap.com/lbs/static/addToolbar.js"></script>
    <script type="text/javascript" src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"> </script>
</head>
<body>
<div id="container"></div>
<div class="button-group">
    <button onclick="change(114.514793,38.042225,'HB')">河北</button>
    <button onclick="change(121.464404,31.229357,'SH')">上海</button>
</div>
<script>
    var map = new AMap.Map("container", {
        resizeEnable: true,
        center: [121.464404,31.229357],
        zoom: 11
    });
    function change(a,b,d){
        map.setZoomAndCenter(11, [a*1,b*1]);
        getAddress(geocoder,d);
    }
    if (!isSupportCanvas()) {
        alert('热力图仅对支持canvas的浏览器适用,您所使用的浏览器不能使用热力图功能,请换个浏览器试试~')
    }
    var geocoder
    AMap.plugin('AMap.Geocoder',function(){
        geocoder = new AMap.Geocoder({
            city: ""//城市，默认：“全国”
        });

        getAddress(geocoder)
    });
    function getAddress(geocoder,data) {
        $.ajax({
            url: 'http://beidouchaxun.cn/server/getXlcAddress?type='+data,
            type: 'get',
            dataType: "jsonp",
            success: function (dat) {
                console.log(dat)
                for(var i in dat.data){
                    getIt(dat.data[i],geocoder)
                }
            }
        })
    }
    function getIt(dat,geocoder){
        /*var marker = new AMap.Marker({
            map:map,
            bubble:true
        })*/
        geocoder.getLocation(dat.addr, function (status, result) {
            if ((status == 'complete' && result.geocodes.length) || (dat.lng && dat.lat)) {
               // marker.setPosition(result.geocodes[0].location);
                var ellLocation= (dat.lng && dat.lat) ? {lng:dat.lng,lat:dat.lat,L:dat.lng,N:dat.lat} :result.geocodes[0].location
                var ellipse = new AMap.Ellipse({
                    map: map, center: ellLocation, radius: [ 5000, 5000 ],
                    strokeOpacity:0, fillColor:'red', fillOpacity:0.5, zIndex:10,
                    bubble:true, cursor:'pointer', bubble: false
                })
                AMap.event.addListener(ellipse, 'mouseover', function() {
                    //GDMap.openInfoWindow(data,map);
                    var InfoWindow = new AMap.InfoWindow({
                        isCustom: true,  //使用自定义窗体
                        content: '<div>'+dat.name +'</div>',
                        offset: new AMap.Pixel(0, 0),
                        zIndex:999
                    });
                    InfoWindow.open(
                        map,ellLocation
                    )
                });


                /*map.setCenter(marker.getPosition())*/
                console.log('成功')
            } else {
                console.log('失败',dat.addr);

            }
        })
    }

    //判断浏览区是否支持canvas
    function isSupportCanvas() {
        var elem = document.createElement('canvas');
        return !!(elem.getContext && elem.getContext('2d'));
    }
</script>
</body>
</html>