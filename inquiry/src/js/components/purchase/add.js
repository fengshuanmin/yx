import React from 'react'
import $ from 'jquery'
require('../../../css/home.css')
import {BaseLi,SubmitOk} from '../../../../../common/assembly/Stateless';
import { Switch } from 'antd';
export default class NewAddress extends React.Component{
    constructor(props){
        super(props);
        this.state={
            sfval:''
        }
        this.submit=()=>{
            console.log(this.props.location.state.name)
            this.props.setProps({ssq:{sf:this.state.sflist,cs:this.state.cslist,qy:this.state.qylist},list:{name:this.props.location.state.name,
                phone:this.props.location.state.phone,addrDetail:this.props.location.state.addrDetail,
                isDefault:this.props.location.state.isDefault}})
            this.props.history.goBack();
        }
        this.sf=(e)=>{
            this.props.ajax({
                url:'/server/lexiu1-app/business/dictAddr/sf?token='+this.props.user.data.token,
                type:'GET',
                suc:(dat)=>{
                    console.log(dat.sf)
                    this.setState({
                        sf:dat.sf
                    })

                }
            })
            let value = e.target.value;
            console.log(value)
            console.log(this.state.sf)
            for(var i in this.state.sf){
                if(this.state.sf[i].SFMC==value){
                    this.setState({
                        sflist:{
                            sfid:this.state.sf[i].id,
                            sfval:value,
                        }
                    })
                    this.props.ajax({
                        url:'/server/lexiu1-app/business/dictAddr/cs/'+this.state.sf[i].id+'?token='+this.props.user.data.token,
                        type:'GET',
                        suc:(data)=>{
                            console.log(data.cs)
                            this.setState({
                                cs:data.cs,
                                cslist:{
                                    csid:data.cs[0].id,
                                    csval:data.cs[0].CSMC
                                }
                            })
                            this.props.ajax({
                                url:'/server/lexiu1-app/business/dictAddr/x/'+data.cs[0].id+'?token='+this.props.user.data.token,
                                type:'GET',
                                suc:(result)=>{
                                    console.log(result)
                                    if(result.x.length==0){
                                        this.setState({
                                            qy:[],
                                            qylist:{
                                                qyid:'',
                                                qyval:''
                                            }
                                        })
                                    }else{
                                        this.setState({
                                            qy:result.x,
                                            qylist:{
                                                qyid:result.x[0].id,
                                                qyval:result.x[0].XMC
                                            }
                                        })
                                    }

                                }
                            })
                        }
                    })
                }
            }
            console.log(this.state.sf)
        }
        this.sj=(e)=>{
            console.log(this.state.sflist.sfid)
            if(this.state.sflist.sfid){
                this.props.ajax({
                    url:'/server/lexiu1-app/business/dictAddr/cs/'+this.state.sflist.sfid+'?token='+this.props.user.data.token,
                    type:'GET',
                    suc:(data)=>{
                        console.log(data.cs)
                        this.setState({
                            cs:data.cs
                        })

                    }
                })
                let value1 = e.target.value;
                console.log(value1)
                console.log(this.state.cs)
                for(var c in this.state.cs){
                    if(this.state.cs[c].CSMC==value1){
                        this.setState({
                            cslist:{
                                csid:this.state.cs[c].id,
                                csval:value1,
                            }
                        })
                        this.props.ajax({
                            url:'/server/lexiu1-app/business/dictAddr/x/'+this.state.cs[c].id+'?token='+this.props.user.data.token,
                            type:'GET',
                            suc:(result)=>{
                                console.log(result)
                                if(result.x.length==0){
                                    this.setState({
                                        qy:[],
                                        qylist:{
                                            qyid:'',
                                            qyval:''
                                        }
                                    })
                                }else{
                                    this.setState({
                                        qy:result.x,
                                        qylist:{
                                            qyid:result.x[0].id,
                                            qyval:result.x[0].XMC
                                        }
                                    })
                                }
                            }
                        })
                    }
                }
            }else{
                this.props.promptInfo({
                    content:'请输入省份',
                    Prompt:true,
                    onlyOK:true
                })
            }
        }
        this.qy=(e)=>{
            if(this.state.cslist.csid){
                this.props.ajax({
                    url:'/server/lexiu1-app/business/dictAddr/x/'+this.state.cslist.csid+'?token='+this.props.user.data.token,
                    type:'GET',
                    suc:(result)=>{
                        console.log(result)
                        if(result.x.length==0){
                            this.setState({
                                qy:[],
                                qylist:{
                                    qyid:'',
                                    qyval:''
                                }
                            })
                        }else{
                            let value2 = e.target.value;
                            console.log(value2)
                            console.log(this.state.qy)
                            for(var q in result.x){
                                if(result.x[q].XMC==value2){
                                    this.setState({
                                        qy:result.x,
                                        qylist:{
                                            qyid:this.state.qy[q].id,
                                            qyval:value2,
                                        }
                                    })
                                }
                            }
                        }
                    }
                })
            }else{
                this.props.promptInfo({
                    content:'请输入所属市',
                    Prompt:true,
                    onlyOK:true
                })
            }
        }
    }
    componentDidMount(){
        this.props.changeTitle('选择区域')
        console.log(this.props)
      this.props.ajax({
            url:'/server/lexiu1-app/business/dictAddr/sf?token='+this.props.user.data.token,
            type:'GET',
            suc:(dat)=>{
                console.log(dat.sf)
                this.setState({
                    sf:dat.sf,
                    sflist:{
                        sfid:dat.sf[0].id,
                        sfval:dat.sf[0].SFMC
                    }
                })
                this.props.ajax({
                    url:'/server/lexiu1-app/business/dictAddr/cs/'+dat.sf[0].id+'?token='+this.props.user.data.token,
                    type:'GET',
                    suc:(data)=>{
                        console.log(data.cs)
                        this.setState({
                            cs:data.cs,
                            cslist:{
                                csid:data.cs[0].id,
                                csval:data.cs[0].CSMC
                            }
                        })
                        this.props.ajax({
                            url:'/server/lexiu1-app/business/dictAddr/x/'+data.cs[0].id+'?token='+this.props.user.data.token,
                            type:'GET',
                            suc:(result)=>{
                                console.log(result)
                                this.setState({
                                    qy:result.x,
                                    qylist:{
                                        qyid:result.x[0].id,
                                        qyval:result.x[0].XMC
                                    }
                                })

                            }
                        })
                    }
                })
            }
        })
    }
    render(){
        console.log(this.state)
        console.log(this.props.location.state)
        return(
            <div>
                <ul className="cs">
                    <li>
                        <span>省份：</span>
                        <span></span>
                        <select name="city" id="city" className='sf' onChange={this.sf}>
                            {this.state.sf&&this.state.sf.map((item,index)=>{
                                return(
                                    <option value={item.SFMC}>{item.SFMC}</option>
                                )
                            })}
                        </select>
                    </li>
                    <li>
                        <span>市：</span>
                        <span></span>
                        <select name="city" id="city" className='sf' onChange={this.sj}>
                            {this.state.cs&&this.state.cs.map((item,index)=>{
                                return(
                                    <option value={item.CSMC}>{item.CSMC}</option>
                                )
                            })}
                        </select>
                    </li>
                    <li>
                        <span>区：</span>
                        <span></span>
                        <select name="city" id="city" className='sf' onChange={this.qy}>
                            {this.state.qy&&this.state.qy.map((item,index)=>{
                                return(
                                    <option value={item.XMC}>{item.XMC}</option>
                                )
                            })}
                        </select>
                    </li>
                </ul>
                <div style={{width:'100vw',height:'1rem',marginTop:'0.5rem'}}>
                    <button onClick={this.submit} style={{border:'0px',width:'92%',height:'1rem',marginLeft:'4%',background:'#3A97F7',color:'#fff',borderRadius:'0.1rem',fontSize:'0.32rem'}}>保存</button>
                </div>
            </div>
        )
    }
}